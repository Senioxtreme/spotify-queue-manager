<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="theme-color" content="#0f0f0f" />
<title>Spotify Song Queue — Guide</title>
<style>
  *,*::before,*::after{box-sizing:border-box}
  :root{
    --bg:#0f0f0f; --bg-2:#141414; --bg-3:#1a1a1a;
    --text:#f7f7f7; --muted:#bdbdbd;
    --brand:#1DB954; --brand-2:#1ED760;
    --accent:#25f39a; --danger:#ff5e5e; --warn:#f6c14b;
    --radius:16px; --shadow:0 12px 40px rgba(0,0,0,.35);
    --code:#0d1117; --code-b:#22252c; --mono: ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;
  }
  html,body{height:100%}
  body{
    margin:0; color:var(--text);
    background:
      radial-gradient(1000px 600px at 10% -10%, rgba(29,185,84,.15), rgba(29,185,84,0) 60%),
      radial-gradient(1000px 600px at 110% 0%, rgba(30,215,96,.10), rgba(30,215,96,0) 60%),
      linear-gradient(180deg,#0b0b0b, #101010 40%, #0f1a14 100%);
    font-family: ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;
    -webkit-font-smoothing:antialiased; line-height:1.55;
    display:flex; flex-direction:column;
  }
  header{
    position:sticky; top:0; z-index:50;
    backdrop-filter:saturate(140%) blur(8px);
    background:linear-gradient(to bottom, rgba(16,16,16,.96), rgba(16,16,16,.65));
    border-bottom:1px solid rgba(255,255,255,.06);
  }
  .wrap{max-width:1120px;margin:0 auto;padding:16px}
  .hero{display:grid;grid-template-columns:auto 1fr auto;gap:16px;align-items:center}
  .brand{display:flex;align-items:center;gap:12px}
  .brand img{width:36px;height:36px}
  .brand h1{font-size:18px;margin:0;font-weight:900;letter-spacing:.2px}
  .switchers{display:flex;gap:8px;flex-wrap:wrap;justify-content:flex-end}
  .seg{display:flex;gap:6px;background:var(--bg-2);border:1px solid rgba(255,255,255,.08);border-radius:999px;padding:6px}
  .seg button,.seg select{
    border:none;background:transparent;color:#eaeaea;border-radius:999px;padding:8px 14px;font-weight:700;cursor:pointer
  }
  .seg button[aria-pressed="true"]{background:linear-gradient(45deg,var(--brand),var(--brand-2));color:#0a0a0a}
  .seg select{background:#181c18;border:1px solid rgba(255,255,255,.08);padding:8px 12px}

  main{flex:1}
  .grid{display:grid;gap:16px;padding:16px;grid-template-columns:1.2fr 1fr}
  @media (max-width:1000px){.grid{grid-template-columns:1fr}}
  .card{
    background:linear-gradient(180deg,var(--bg-2),var(--bg-3));
    border:1px solid rgba(255,255,255,.08);
    border-radius:var(--radius); box-shadow:var(--shadow);
    overflow:hidden;
  }
  .head{display:flex;align-items:center;gap:10px;padding:14px;border-bottom:1px solid rgba(255,255,255,.06)}
  .head h2{margin:0;font-size:16px}
  .body{padding:16px}
  .muted{color:var(--muted)}
  .pill{display:inline-flex;align-items:center;gap:8px;padding:6px 10px;border-radius:999px;font-size:12px;background:#171717;border:1px solid rgba(255,255,255,.08)}
  .ok{color:#0b0}.bad{color:#ff8c8c}

  ol.steps, ul.list{margin:0;padding-left:18px}
  ol.steps li, ul.list li{margin:6px 0}

  .callout{
    background:#151c16;border:1px solid rgba(37,243,154,.25);
    padding:12px;border-radius:12px; display:flex; gap:10px; align-items:flex-start;
  }
  .callout .ico{font-size:18px}
  .warn{background:#1e1a12;border-color:rgba(246,193,75,.3)}
  .err{background:#221414;border-color:rgba(255,94,94,.35)}

  pre{margin:0}
  .code{
    background:var(--code); border:1px solid var(--code-b);
    border-radius:12px; overflow:auto; position:relative; margin:12px 0;
  }
  .code pre{font-family:var(--mono); font-size:12.5px; color:#e6edf3; padding:12px 14px}
  .toolbar{
    position:sticky; top:0; display:flex; justify-content:flex-end; gap:8px;
    background:linear-gradient(180deg,#0f1318,#0d1217); border-bottom:1px solid #1f232b; padding:8px 10px;
  }
  .btn{border:none;border-radius:10px;padding:8px 10px;background:#222836;color:#e6edf3;font-weight:700;cursor:pointer;transition:transform .15s ease,opacity .2s ease;font-size:12px}
  .btn:hover{transform:translateY(-1px);opacity:.95}
  .btn.brand{background:linear-gradient(45deg,var(--brand),var(--brand-2));color:#0a0a0a}
  .btn.ghost{background:#1a1f2b}

  [data-pane]{display:none;animation:fade .2s ease}
  [data-pane].active{display:block}
  @keyframes fade{from{opacity:0;transform:translateY(4px)}to{opacity:1;transform:translateY(0)}}

  .columns{display:grid;grid-template-columns:1fr 1fr;gap:12px}
  @media (max-width:720px){.columns{grid-template-columns:1fr}}
  footer{padding:18px;text-align:center;color:var(--muted);font-size:12px;border-top:1px solid rgba(255,255,255,.06)}
  footer a{color:var(--brand);text-decoration:none}
</style>
</head>
<body>

<header>
  <div class="wrap hero">
    <div class="brand">
      <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/1/19/Spotify_logo_without_text.svg/2048px-Spotify_logo_without_text.svg.png" alt="Spotify" />
      <h1 data-i18n="title">Spotify Song Queue — Guide</h1>
    </div>
    <div class="muted" id="lead" data-i18n="lead">Quick instructions to use or integrate the app.</div>
    <div class="switchers">
      <div class="seg" role="tablist" aria-label="Role">
        <button id="tab-user" class="role" role="tab" aria-pressed="true" data-role="user" data-i18n="role_user">User</button>
        <button id="tab-dev" class="role" role="tab" aria-pressed="false" data-role="dev" data-i18n="role_dev">Dev</button>
      </div>
      <div class="seg">
        <select id="lang">
          <option value="it">Italiano</option>
          <option value="en" selected>English</option>
        </select>
      </div>
    </div>
  </div>
</header>

<main class="wrap">
  <div class="grid">

    <!-- USER PANE -->
    <section class="card active" data-pane data-role="user">
      <div class="head"><h2 data-i18n="user_howto">How to use</h2></div>
      <div class="body">
        <ol class="steps" id="user-steps">
          <li data-i18n="u1">Open the web app.</li>
          <li data-i18n="u2">Type a song/artist in the search field and press <b>Search</b>.</li>
          <li data-i18n="u3">In results: click <b>Preview</b> to listen, or <b>Add to queue</b> to queue it on your active device.</li>
          <li data-i18n="u4">On success: cover animation, “Queued ✓” badge, confetti, and History updated.</li>
        </ol>

        <div class="columns" style="margin-top:12px">
          <div class="callout"><span class="ico">ℹ️</span>
            <div><b data-i18n="hist_t">History</b> <span class="muted" data-i18n="hist_txt">stores your last 5 queued tracks. Use Clear to wipe it.</span></div>
          </div>
          <div class="callout warn"><span class="ico">⏱️</span>
            <div><b data-i18n="limits_t">Rate limit</b> <span class="muted" data-i18n="limits_txt">Max 3 tracks / 10 min. If exceeded, the add is blocked: no history, no animation.</span></div>
          </div>
        </div>

        <h3 style="margin-top:18px" data-i18n="req_t">Requirements</h3>
        <ul class="list">
          <li data-i18n="req1">An <b>active Spotify device</b> on your account (app open and ready).</li>
          <li data-i18n="req2">If there’s no device: you’ll see “No active device” and nothing will be saved or counted.</li>
        </ul>

        <h3 style="margin-top:18px" data-i18n="kb_t">Keyboard</h3>
        <ul class="list">
          <li data-i18n="kb1"><b>/</b> focuses the search.</li>
          <li data-i18n="kb2"><b>Enter</b> starts the search.</li>
        </ul>

        <h3 style="margin-top:18px" data-i18n="tr_t">Troubleshooting</h3>
        <ul class="list">
          <li data-i18n="tr1"><b>No preview?</b> Not all tracks have one. If missing, an embedded Spotify player opens.</li>
          <li data-i18n="tr2"><b>No audio?</b> Check browser permissions / autoplay / mute.</li>
          <li data-i18n="tr3"><b>Token issues?</b> Ask the admin/dev to refresh the token.</li>
        </ul>
      </div>
    </section>

    <!-- DEV PANE -->
    <section class="card" data-pane data-role="dev">
      <div class="head"><h2 data-i18n="dev_setup">Setup & Integration</h2></div>
      <div class="body">
        <div class="columns">
          <div>
            <h3 data-i18n="files_t">Files</h3>
            <ul class="list">
              <li><code>index.html</code> — UI, UIBridge, toasts, modal embed, animations</li>
              <li><code>script.js</code> — search, queue add (2xx=success), rate limit, preview data</li>
            </ul>
            <div class="callout warn" style="margin:12px 0"><span class="ico">⚠️</span>
              <div data-i18n="token_warn"><b>Do not expose secrets in the client.</b> If you need real security, use a backend/proxy and keep the token in a server-side .env.</div>
            </div>
          </div>
          <div>
            <h3 data-i18n="ui_t">UI Bridge events</h3>
            <div class="code">
              <div class="toolbar"><button class="btn brand" data-copy="#c-bridge">Copy</button></div>
<pre id="c-bridge"><code>// index.html → triggers search
document.dispatchEvent(new CustomEvent('ui:search', {
  detail: { query: term, limit: 10 }
}));

// script.js → renders results
UIBridge.renderItems([
  { image, title, subtitle, uri, preview, onclick: () => addToQueue(uri) }
]);</code></pre>
            </div>
          </div>
        </div>

        <h3 style="margin-top:8px" data-i18n="search_t">Search with preview</h3>
        <p class="muted" data-i18n="search_p">Tries in order: <code>market=from_token</code> → no market → <code>market=IT</code>. Each item passes <code>uri</code> and <code>preview</code>.</p>
        <div class="code">
          <div class="toolbar"><button class="btn brand" data-copy="#c-search">Copy</button></div>
<pre id="c-search"><code>async function doSearch(q, limit=10){
  const tries = [
    `/v1/search?q=${encodeURIComponent(q)}&type=track&limit=${limit}&market=from_token`,
    `/v1/search?q=${encodeURIComponent(q)}&type=track&limit=${limit}`,
    `/v1/search?q=${encodeURIComponent(q)}&type=track&limit=${limit}&market=IT`
  ];
  // fetch with Authorization: Bearer & map items → {image,title,subtitle,uri,preview}
}</code></pre>
        </div>

        <h3 data-i18n="queue_t">Queue add (boolean)</h3>
        <p class="muted" data-i18n="queue_p">UI updates (history/animation/limit) only if <code>addToQueue</code> returns <code>true</code> (any 2xx).</p>
        <div class="code">
          <div class="toolbar"><button class="btn brand" data-copy="#c-queue">Copy</button></div>
<pre id="c-queue"><code>async function addToQueue(uri){
  const res = await fetch('/v1/me/player/queue?uri='+encodeURIComponent(uri), { method:'POST', headers:{Authorization:'Bearer '+accessToken}});
  if(res.ok) return true;
  if(res.status===404){ alert('No active devices...'); return false; }
  if(res.status===401){ alert('Token expired...');    return false; }
  if(res.status===429){ alert('Rate limit...');       return false; }
  if(res.status===403){ alert('Forbidden / scopes');  return false; }
  alert('Could not add to queue. Try again.'); return false;
}</code></pre>
        </div>

        <div class="columns" style="margin-top:8px">
          <div>
            <h3 data-i18n="limit_t">Rate limit (client)</h3>
            <ul class="list">
              <li data-i18n="limit1">3 adds / 10 min with localStorage timestamps.</li>
              <li data-i18n="limit2">Blocked adds don’t animate or go to History.</li>
            </ul>
          </div>
          <div>
            <h3 data-i18n="security_t">Security</h3>
            <ul class="list">
              <li data-i18n="sec1">Use a proxy to hide tokens in production.</li>
              <li data-i18n="sec2">Add CORS, rate limiting, and auth if public.</li>
            </ul>
          </div>
        </div>

        <h3 style="margin-top:8px" data-i18n="proxy_t">Node proxy (optional)</h3>
        <div class="code">
          <div class="toolbar">
            <button class="btn ghost" data-copy="#c-env">.env</button>
            <button class="btn brand" data-copy="#c-proxy">server.js</button>
          </div>
<pre id="c-env"><code>SPOTIFY_TOKEN=YOUR_SPOTIFY_TOKEN</code></pre>
<pre id="c-proxy"><code>import express from 'express';
import fetch from 'node-fetch';
import dotenv from 'dotenv';
dotenv.config();
const app = express();

app.get('/api/search', async (req,res)=>{
  const q = String(req.query.q||'');
  const r = await fetch('https://api.spotify.com/v1/search?q='+encodeURIComponent(q)+'&type=track&limit=10',
    { headers:{ Authorization:`Bearer ${process.env.SPOTIFY_TOKEN}` } });
  res.status(r.status).json(await r.json());
});

app.post('/api/queue', async (req,res)=>{
  const uri = String(req.query.uri||'');
  const r = await fetch('https://api.spotify.com/v1/me/player/queue?uri='+encodeURIComponent(uri),
    { method:'POST', headers:{ Authorization:`Bearer ${process.env.SPOTIFY_TOKEN}` }});
  res.status(r.status).end();
});

app.listen(3000, ()=>console.log('Proxy http://localhost:3000'));</code></pre>
        </div>

        <div class="columns" style="margin-top:8px">
          <div>
            <h3 data-i18n="deploy_t">Deploy</h3>
            <ul class="list">
              <li data-i18n="dep1">Static hosting (UI) + server (proxy), o tutto su un PaaS (Railway/Render/Vercel).</li>
              <li data-i18n="dep2">Configura variabili d’ambiente per il token.</li>
            </ul>
          </div>
          <div>
            <h3 data-i18n="versioning_t">Versioning</h3>
            <ul class="list">
              <li><b data-i18n="ver_now">Current:</b> 2.1.0</li>
              <li data-i18n="ver_rules">Minor (2.1.x) for fixes; 2.2.0 for new features.</li>
            </ul>
          </div>
        </div>
      </div>
    </section>

  </div>

  <section class="card" style="margin:16px 0">
    <div class="head"><h2 data-i18n="faq_t">FAQ</h2></div>
    <div class="body">
      <div class="columns">
        <div>
          <h4 data-i18n="fq1_q">Why no preview for some tracks?</h4>
          <p class="muted" data-i18n="fq1_a">Spotify doesn’t provide preview_url for all tracks. We open an embedded player as a fallback.</p>
        </div>
        <div>
          <h4 data-i18n="fq2_q">Why do I need an active device?</h4>
          <p class="muted" data-i18n="fq2_a">Spotify queues only on an active device linked to your account.</p>
        </div>
        <div>
          <h4 data-i18n="fq3_q">Can I hide the token with a .env?</h4>
          <p class="muted" data-i18n="fq3_a">Not in a pure client app. Use a backend/proxy—keep secrets server-side.</p>
        </div>
        <div>
          <h4 data-i18n="fq4_q">Does the limit apply across devices?</h4>
          <p class="muted" data-i18n="fq4_a">Client-side limit is per browser. Server-side limits require backend logic.</p>
        </div>
      </div>
    </div>
  </section>

</main>

<footer>
  Made with 💚 — <a href="https://senioxtreme.it" target="_blank" rel="noreferrer noopener">Senioxtreme</a>
</footer>

<script>
  const dict = {
    it: {
      title: "Spotify Song Queue — Guida",
      lead: "Istruzioni chiare per usare o integrare l’app.",
      role_user: "Utente",
      role_dev: "Dev",
      user_howto: "Come si usa",
      u1: "Apri la web app.",
      u2: "Cerca un brano o artista e premi «Search».",
      u3: "Nei risultati: «Preview» per ascoltare, «Add to queue» per accodare sul dispositivo attivo.",
      u4: "Se va a buon fine: animazione copertina, badge “Queued ✓”, confetti e aggiornamento History.",
      hist_t: "History",
      hist_txt: "mostra gli ultimi 5 brani accodati. Usa «Clear» per svuotarla.",
      limits_t: "Limiti anti-spam",
      limits_txt: "Max 3 brani ogni 10 minuti. Se superi il limite, l’aggiunta è bloccata (niente history/animazioni).",
      req_t: "Requisiti",
      req1: "Un dispositivo Spotify attivo collegato al tuo account.",
      req2: "Senza device attivo: vedi “No active device” e l’azione non viene salvata o conteggiata.",
      kb_t: "Tastiera",
      kb1: "«/» mette a fuoco la ricerca.",
      kb2: "«Invio» avvia la ricerca.",
      tr_t: "Troubleshooting",
      tr1: "Nessuna preview? Non tutti i brani la hanno. In assenza usiamo il player incorporato.",
      tr2: "Niente audio? Controlla permessi, autoplay o mute del browser.",
      tr3: "Token? Chiedi a chi gestisce l’app di aggiornarlo.",
      dev_setup: "Setup & Integrazione",
      files_t: "Struttura file",
      token_warn: "Non esporre il token nel client. Per sicurezza reale usa un backend/proxy con .env lato server.",
      ui_t: "UI Bridge",
      search_t: "Ricerca con preview",
      search_p: "Tenta: market=from_token → senza market → market=IT. Ogni item fornisce uri e preview.",
      queue_t: "Aggiunta in coda (boolean)",
      queue_p: "La UI aggiorna solo se addToQueue ritorna true (qualunque 2xx).",
      limit_t: "Limite",
      limit1: "3 aggiunte / 10 minuti via localStorage.",
      limit2: "Se bloccato, niente animazione né History.",
      security_t: "Sicurezza",
      sec1: "In produzione usa un proxy per nascondere il token.",
      sec2: "Aggiungi CORS, rate limit e auth se pubblico.",
      proxy_t: "Proxy Node (opzionale)",
      deploy_t: "Deploy",
      dep1: "Hosting statico per la UI + server per il proxy, o PaaS unificato.",
      dep2: "Configura le variabili d’ambiente per il token.",
      versioning_t: "Versioning",
      ver_now: "Versione corrente:",
      ver_rules: "Patch: 2.1.x per fix. Nuove feature → 2.2.0.",
      faq_t: "FAQ",
      fq1_q: "Perché alcuni brani non hanno l’anteprima?",
      fq1_a: "Spotify non fornisce sempre preview_url. In tal caso apriamo il player incorporato.",
      fq2_q: "Perché serve un device attivo?",
      fq2_a: "L’API accoda solo su un device attivo del tuo account.",
      fq3_q: "Posso nascondere il token con un .env client?",
      fq3_a: "No, nel client finisce in chiaro. Usa un backend.",
      fq4_q: "Il limite vale su tutti i dispositivi?",
      fq4_a: "Quello client è per browser. Un limite server richiede backend."
    },
    en: {
      title: "Spotify Song Queue — Guide",
      lead: "Quick instructions to use or integrate the app.",
      role_user: "User",
      role_dev: "Dev",
      user_howto: "How to use",
      u1: "Open the web app.",
      u2: "Search for a track or artist and press “Search”.",
      u3: "In results: use “Preview” to listen, or “Add to queue” for your active device.",
      u4: "On success: cover animation, “Queued ✓” badge, confetti, and History updated.",
      hist_t: "History",
      hist_txt: "shows the last 5 queued tracks. Use «Clear» to wipe it.",
      limits_t: "Rate limit",
      limits_txt: "Max 3 tracks per 10 minutes. If exceeded, the add is blocked (no history/animations).",
      req_t: "Requirements",
      req1: "An active Spotify device linked to your account.",
      req2: "If no device: you’ll see “No active device”; nothing is saved or counted.",
      kb_t: "Keyboard",
      kb1: "“/” focuses search.",
      kb2: "“Enter” triggers search.",
      tr_t: "Troubleshooting",
      tr1: "No preview? Not all tracks have one. We use the embedded player when missing.",
      tr2: "No audio? Check permissions, autoplay, or browser mute.",
      tr3: "Token issues? Ask the admin/dev to refresh it.",
      dev_setup: "Setup & Integration",
      files_t: "Files",
      token_warn: "Don’t expose secrets client-side. Use a backend/proxy with server-side .env.",
      ui_t: "UI Bridge",
      search_t: "Search with preview",
      search_p: "Tries: market=from_token → no market → market=IT. Each item has uri and preview.",
      queue_t: "Queue add (boolean)",
      queue_p: "UI updates only if addToQueue returns true (any 2xx).",
      limit_t: "Limit",
      limit1: "3 adds / 10 minutes via localStorage.",
      limit2: "Blocked adds do not animate or enter History.",
      security_t: "Security",
      sec1: "Use a proxy in production to hide tokens.",
      sec2: "Add CORS, rate limiting, and auth if public.",
      proxy_t: "Node proxy (optional)",
      deploy_t: "Deploy",
      dep1: "Static hosting for UI + server for proxy, or a unified PaaS.",
      dep2: "Configure environment variables for the token.",
      versioning_t: "Versioning",
      ver_now: "Current:",
      ver_rules: "Patch: 2.1.x for fixes. New features → 2.2.0.",
      faq_t: "FAQ",
      fq1_q: "Why do some tracks have no preview?",
      fq1_a: "Spotify doesn’t always provide preview_url. We open the embedded player instead.",
      fq2_q: "Why do I need an active device?",
      fq2_a: "The API queues only on an active device linked to your account.",
      fq3_q: "Can I hide the token with a client .env?",
      fq3_a: "No—client bundles expose it. Use a backend.",
      fq4_q: "Does the limit apply across devices?",
      fq4_a: "Client limit is per browser. Cross-device requires backend logic."
    }
  };

  const langSel = document.getElementById('lang');
  const roleBtns = document.querySelectorAll('.role');
  const panes = document.querySelectorAll('[data-pane]');
  const i18nNodes = document.querySelectorAll('[data-i18n]');

  function setLang(l){
    document.documentElement.lang = l;
    i18nNodes.forEach(n=>{
      const k = n.getAttribute('data-i18n');
      const t = dict[l][k];
      if(typeof t === 'string') n.innerHTML = t;
    });
  }

  function setRole(r){
    roleBtns.forEach(b=> b.setAttribute('aria-pressed', b.dataset.role===r ? 'true' : 'false'));
    panes.forEach(p=> p.classList.toggle('active', p.dataset.role===r));
    window.scrollTo({top:0,behavior:'smooth'});
  }

  langSel.addEventListener('change', ()=> setLang(langSel.value));
  roleBtns.forEach(b=> b.addEventListener('click', ()=> setRole(b.dataset.role)));

  setLang(langSel.value);
  setRole('user');

  document.querySelectorAll('[data-copy]').forEach(btn=>{
    btn.addEventListener('click', async ()=>{
      const id = btn.getAttribute('data-copy');
      const el = document.querySelector(id);
      if(!el) return;
      const text = el.innerText;
      try{
        await navigator.clipboard.writeText(text);
        const old = btn.textContent; btn.textContent = (langSel.value==='it'?'Copiato!':'Copied!');
        setTimeout(()=> btn.textContent = old, 1200);
      }catch{
        const ta=document.createElement('textarea'); ta.value=text; document.body.appendChild(ta);
        ta.select(); document.execCommand('copy'); ta.remove();
        const old = btn.textContent; btn.textContent = (langSel.value==='it'?'Copiato!':'Copied!');
        setTimeout(()=> btn.textContent = old, 1200);
      }
    });
  });
</script>
</body>
</html>
